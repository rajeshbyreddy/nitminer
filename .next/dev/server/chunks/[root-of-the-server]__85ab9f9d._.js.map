{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///Users/rajeshbyreddy/nitminer/client/src/lib/dbConnect.ts"],"sourcesContent":["import mongoose from 'mongoose';\n\nconst MONGODB_URI = process.env.MONGODB_URI;\n\nif (!MONGODB_URI) {\n  throw new Error('Please define the MONGODB_URI environment variable');\n}\n\ninterface Cached {\n  conn: typeof mongoose | null;\n  promise: Promise<typeof mongoose> | null;\n}\n\nlet cached: Cached = (global as any).mongoose || { conn: null, promise: null };\n\nif (!cached) {\n  cached = (global as any).mongoose = { conn: null, promise: null };\n}\n\nasync function dbConnect() {\n  if (cached.conn) {\n    return cached.conn;\n  }\n\n  if (!cached.promise) {\n    const opts = {\n      bufferCommands: false,\n    };\n\n    cached.promise = mongoose.connect(MONGODB_URI!, opts).then((mongoose) => {\n      return mongoose;\n    });\n  }\n\n  try {\n    cached.conn = await cached.promise;\n  } catch (e) {\n    cached.promise = null;\n    throw e;\n  }\n\n  return cached.conn;\n}\n\nexport default dbConnect;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MAAM;AAClB;AAOA,IAAI,SAAiB,yDAAgB,QAAQ,IAAI;IAAE,MAAM;IAAM,SAAS;AAAK;AAE7E,IAAI,CAAC,QAAQ;IACX,SAAS,yDAAgB,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAClE;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,OAAO,OAAO,GAAG,mKAAQ,CAAC,OAAO,CAAC,aAAc,MAAM,IAAI,CAAC,CAAC;YAC1D,OAAO;QACT;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB;uCAEe"}},
    {"offset": {"line": 151, "column": 0}, "map": {"version":3,"sources":["file:///Users/rajeshbyreddy/nitminer/client/src/models/User.ts"],"sourcesContent":["import mongoose, { Schema, Document } from 'mongoose';\n\nexport interface IUser extends Document {\n  name: string;\n  email: string;\n  password?: string;\n  googleId?: string;\n  role: 'user' | 'admin';\n  trialCount: number;\n  isPremium: boolean;\n  subscriptionExpiry: Date | null;\n  subscription?: {\n    plan: '1_month' | '6_months' | '12_months';\n    status: 'active' | 'expired' | 'cancelled';\n    startDate: Date;\n    endDate: Date;\n    paymentId: mongoose.Types.ObjectId;\n  };\n  settings?: {\n    emailNotifications: boolean;\n    pushNotifications: boolean;\n    marketingEmails: boolean;\n    theme: string;\n    language: string;\n    timezone: string;\n    twoFactorAuth: boolean;\n  };\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst userSchema = new Schema<IUser>(\n  {\n    name: {\n      type: String,\n      required: true,\n      trim: true,\n    },\n    email: {\n      type: String,\n      required: true,\n      unique: true,\n      lowercase: true,\n      trim: true,\n    },\n    password: {\n      type: String,\n      select: false, // Don't return password by default\n    },\n    googleId: {\n      type: String,\n      unique: true,\n      sparse: true, // Allow null values for non-Google users\n    },\n    role: {\n      type: String,\n      enum: ['user', 'admin'],\n      default: 'user',\n    },\n    trialCount: {\n      type: Number,\n      default: 5,\n      min: 0,\n    },\n    isPremium: {\n      type: Boolean,\n      default: false,\n    },\n    subscriptionExpiry: {\n      type: Date,\n      default: null,\n    },\n    subscription: {\n      plan: {\n        type: String,\n        enum: ['1_month', '6_months', '12_months'],\n      },\n      status: {\n        type: String,\n        enum: ['active', 'expired', 'cancelled'],\n        default: 'active',\n      },\n      startDate: {\n        type: Date,\n      },\n      endDate: {\n        type: Date,\n      },\n      paymentId: {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'Payment',\n      },\n    },\n    settings: {\n      emailNotifications: {\n        type: Boolean,\n        default: true,\n      },\n      pushNotifications: {\n        type: Boolean,\n        default: false,\n      },\n      marketingEmails: {\n        type: Boolean,\n        default: false,\n      },\n      theme: {\n        type: String,\n        enum: ['dark', 'light', 'auto'],\n        default: 'dark',\n      },\n      language: {\n        type: String,\n        default: 'en',\n      },\n      timezone: {\n        type: String,\n        default: 'UTC',\n      },\n      twoFactorAuth: {\n        type: Boolean,\n        default: false,\n      },\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Index for faster queries\nuserSchema.index({ isPremium: 1 });\n\nexport const User = mongoose.models.User || mongoose.model<IUser>('User', userSchema);\n"],"names":[],"mappings":";;;;AAAA;;AA+BA,MAAM,aAAa,IAAI,kKAAM,CAC3B;IACE,MAAM;QACJ,MAAM;QACN,UAAU;QACV,MAAM;IACR;IACA,OAAO;QACL,MAAM;QACN,UAAU;QACV,QAAQ;QACR,WAAW;QACX,MAAM;IACR;IACA,UAAU;QACR,MAAM;QACN,QAAQ;IACV;IACA,UAAU;QACR,MAAM;QACN,QAAQ;QACR,QAAQ;IACV;IACA,MAAM;QACJ,MAAM;QACN,MAAM;YAAC;YAAQ;SAAQ;QACvB,SAAS;IACX;IACA,YAAY;QACV,MAAM;QACN,SAAS;QACT,KAAK;IACP;IACA,WAAW;QACT,MAAM;QACN,SAAS;IACX;IACA,oBAAoB;QAClB,MAAM;QACN,SAAS;IACX;IACA,cAAc;QACZ,MAAM;YACJ,MAAM;YACN,MAAM;gBAAC;gBAAW;gBAAY;aAAY;QAC5C;QACA,QAAQ;YACN,MAAM;YACN,MAAM;gBAAC;gBAAU;gBAAW;aAAY;YACxC,SAAS;QACX;QACA,WAAW;YACT,MAAM;QACR;QACA,SAAS;YACP,MAAM;QACR;QACA,WAAW;YACT,MAAM,mKAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;YACpC,KAAK;QACP;IACF;IACA,UAAU;QACR,oBAAoB;YAClB,MAAM;YACN,SAAS;QACX;QACA,mBAAmB;YACjB,MAAM;YACN,SAAS;QACX;QACA,iBAAiB;YACf,MAAM;YACN,SAAS;QACX;QACA,OAAO;YACL,MAAM;YACN,MAAM;gBAAC;gBAAQ;gBAAS;aAAO;YAC/B,SAAS;QACX;QACA,UAAU;YACR,MAAM;YACN,SAAS;QACX;QACA,UAAU;YACR,MAAM;YACN,SAAS;QACX;QACA,eAAe;YACb,MAAM;YACN,SAAS;QACX;IACF;AACF,GACA;IACE,YAAY;AACd;AAGF,2BAA2B;AAC3B,WAAW,KAAK,CAAC;IAAE,WAAW;AAAE;AAEzB,MAAM,OAAO,mKAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,mKAAQ,CAAC,KAAK,CAAQ,QAAQ"}},
    {"offset": {"line": 276, "column": 0}, "map": {"version":3,"sources":["file:///Users/rajeshbyreddy/nitminer/client/src/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["import NextAuth, { type NextAuthOptions, type DefaultSession } from 'next-auth';\nimport CredentialsProvider from 'next-auth/providers/credentials';\nimport GoogleProvider from 'next-auth/providers/google';\nimport bcrypt from 'bcryptjs';\nimport dbConnect from '@/lib/dbConnect';\nimport { User } from '@/models/User';\n\ndeclare module 'next-auth' {\n  interface Session extends DefaultSession {\n    user: {\n      id: string;\n      role: string;\n    } & DefaultSession['user'];\n  }\n}\n\ndeclare module 'next-auth/jwt' {\n  interface JWT {\n    id?: string;\n    role?: string;\n  }\n}\n\nexport const authOptions: NextAuthOptions = {\n  providers: [\n    GoogleProvider({\n      clientId: process.env.GOOGLE_CLIENT_ID || '',\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET || '',\n    }),\n    CredentialsProvider({\n      name: 'Credentials',\n      credentials: {\n        email: { label: 'Email', type: 'email' },\n        password: { label: 'Password', type: 'password' },\n      },\n      async authorize(credentials) {\n        try {\n          console.log('Authorize called with:', { email: credentials?.email, hasPassword: !!credentials?.password });\n          if (!credentials?.email || !credentials?.password) {\n            console.log('Missing credentials');\n            return null;\n          }\n\n          // Demo admin credentials - check/create admin user\n          if (credentials.email === 'admin@nitminer.com' && credentials.password === '12345678') {\n            console.log('Admin login attempt');\n            await dbConnect();\n\n            let adminUser = await User.findOne({ email: 'admin@nitminer.com' });\n\n            if (!adminUser) {\n              console.log('Creating admin user');\n              // Create demo admin user if it doesn't exist\n              adminUser = new User({\n                name: 'Demo Admin',\n                email: 'admin@nitminer.com',\n                password: await bcrypt.hash('12345678', 12),\n                role: 'admin',\n                subscription: 'free',\n                isActive: true,\n              });\n              await adminUser.save();\n              console.log('Admin user created');\n            } else {\n              console.log('Admin user found');\n            }\n\n            return {\n              id: adminUser._id.toString(),\n              email: adminUser.email,\n              name: adminUser.name,\n              role: adminUser.role,\n            };\n          }\n\n          console.log('Regular user login');\n          await dbConnect();\n\n          const user = await User.findOne({ email: credentials.email }).select('+password');\n\n          if (!user) {\n            console.log('User not found');\n            return null;\n          }\n\n          if (!user.password) {\n            console.log('User has no password');\n            return null;\n          }\n\n          const isPasswordValid = await bcrypt.compare(credentials.password, user.password);\n\n          if (!isPasswordValid) {\n            console.log('Invalid password');\n            return null;\n          }\n\n          console.log('Login successful');\n          return {\n            id: user._id.toString(),\n            email: user.email,\n            name: user.name,\n            role: user.role,\n          };\n        } catch (error) {\n          console.error('Auth error:', error);\n          return null;\n        }\n      },\n    }),\n  ],\n  pages: {\n    signIn: '/login',\n  },\n  callbacks: {\n    async signIn({ user, account, profile, email, credentials }) {\n      // Allow sign in for all users\n      return true;\n    },\n    async redirect({ url, baseUrl }) {\n      // If the URL is relative, prepend the base URL\n      if (url.startsWith('/')) return `${baseUrl}${url}`;\n\n      // If the URL is already absolute, allow it\n      if (new URL(url).origin === baseUrl) return url;\n\n      // Default to home page\n      return baseUrl;\n    },\n    async jwt({ token, user, account }: any) {\n      if (user) {\n        token.id = user.id;\n        token.role = user.role;\n      }\n\n      // Handle legacy \"demo-admin\" ID in existing tokens\n      if (token.id === 'demo-admin') {\n        try {\n          await dbConnect();\n          const adminUser = await User.findOne({ email: 'admin@nitminer.com' });\n          if (adminUser) {\n            token.id = adminUser._id.toString();\n            token.role = adminUser.role;\n          }\n        } catch (error) {\n          console.error('Error updating legacy admin token:', error);\n        }\n      }\n\n      // Handle Google Sign-In\n      if (account?.provider === 'google') {\n        try {\n          await dbConnect();\n\n          let dbUser = await User.findOne({ googleId: token.sub });\n\n          if (!dbUser) {\n            // Create new user from Google\n            dbUser = await User.create({\n              name: token.name,\n              email: token.email,\n              googleId: token.sub,\n              role: 'user',\n              trialCount: 5,\n            });\n          }\n\n          token.id = dbUser._id.toString();\n          token.role = dbUser.role;\n        } catch (error) {\n          console.error('Google auth error:', error);\n          // Don't fail the auth, just use default values\n        }\n      }\n\n      return token;\n    },\n    async session({ session, token }: any) {\n      if (session.user) {\n        // Handle legacy \"demo-admin\" ID\n        if (token.id === 'demo-admin') {\n          try {\n            await dbConnect();\n            const adminUser = await User.findOne({ email: 'admin@nitminer.com' });\n            if (adminUser) {\n              session.user.id = adminUser._id.toString();\n              session.user.role = adminUser.role;\n            } else {\n              // If no admin user exists, force logout\n              session.user.id = null;\n              session.user.role = null;\n            }\n          } catch (error) {\n            console.error('Error handling legacy admin ID:', error);\n            session.user.id = null;\n            session.user.role = null;\n          }\n        } else {\n          session.user.id = token.id as string;\n          session.user.role = token.role as string;\n        }\n      }\n      return session;\n    },\n  },\n  session: {\n    strategy: 'jwt',\n    maxAge: 30 * 24 * 60 * 60, // 30 days\n  },\n  jwt: {\n    secret: process.env.NEXTAUTH_SECRET,\n    maxAge: 30 * 24 * 60 * 60, // 30 days\n  },\n  debug: false,\n};\n\nconst handler = NextAuth(authOptions);\nexport { handler as GET, handler as POST };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 494, "column": 0}, "map": {"version":3,"sources":["file:///Users/rajeshbyreddy/nitminer/client/src/models/Payment.ts"],"sourcesContent":["import mongoose, { Schema, Document } from 'mongoose';\n\nexport interface IPayment extends Document {\n  userId: mongoose.Types.ObjectId;\n  plan: '1_month' | '6_months' | '12_months';\n  amount: number;\n  paymentMethod: 'razorpay' | 'card' | 'upi';\n  paymentId: string;\n  orderId?: string;\n  invoiceUrl?: string;\n  status: 'success' | 'pending' | 'failed';\n  completedAt?: Date;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst paymentSchema = new Schema<IPayment>(\n  {\n    userId: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: true,\n    },\n    plan: {\n      type: String,\n      enum: ['1_month', '6_months', '12_months'],\n      required: true,\n    },\n    amount: {\n      type: Number,\n      required: true,\n    },\n    paymentMethod: {\n      type: String,\n      enum: ['razorpay', 'card', 'upi'],\n      required: true,\n    },\n    paymentId: {\n      type: String,\n      required: true,\n      unique: true,\n    },\n    orderId: {\n      type: String,\n      unique: true,\n      sparse: true,\n    },\n    invoiceUrl: {\n      type: String,\n      default: null,\n    },\n    status: {\n      type: String,\n      enum: ['success', 'pending', 'failed'],\n      default: 'pending',\n    },\n    completedAt: {\n      type: Date,\n      default: null,\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Index for faster queries\npaymentSchema.index({ userId: 1 });\npaymentSchema.index({ status: 1 });\npaymentSchema.index({ createdAt: -1 });\n\nexport const Payment = mongoose.models.Payment || mongoose.model<IPayment>('Payment', paymentSchema);\n"],"names":[],"mappings":";;;;AAAA;;AAgBA,MAAM,gBAAgB,IAAI,kKAAM,CAC9B;IACE,QAAQ;QACN,MAAM,mKAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QACpC,KAAK;QACL,UAAU;IACZ;IACA,MAAM;QACJ,MAAM;QACN,MAAM;YAAC;YAAW;YAAY;SAAY;QAC1C,UAAU;IACZ;IACA,QAAQ;QACN,MAAM;QACN,UAAU;IACZ;IACA,eAAe;QACb,MAAM;QACN,MAAM;YAAC;YAAY;YAAQ;SAAM;QACjC,UAAU;IACZ;IACA,WAAW;QACT,MAAM;QACN,UAAU;QACV,QAAQ;IACV;IACA,SAAS;QACP,MAAM;QACN,QAAQ;QACR,QAAQ;IACV;IACA,YAAY;QACV,MAAM;QACN,SAAS;IACX;IACA,QAAQ;QACN,MAAM;QACN,MAAM;YAAC;YAAW;YAAW;SAAS;QACtC,SAAS;IACX;IACA,aAAa;QACX,MAAM;QACN,SAAS;IACX;AACF,GACA;IACE,YAAY;AACd;AAGF,2BAA2B;AAC3B,cAAc,KAAK,CAAC;IAAE,QAAQ;AAAE;AAChC,cAAc,KAAK,CAAC;IAAE,QAAQ;AAAE;AAChC,cAAc,KAAK,CAAC;IAAE,WAAW,CAAC;AAAE;AAE7B,MAAM,UAAU,mKAAQ,CAAC,MAAM,CAAC,OAAO,IAAI,mKAAQ,CAAC,KAAK,CAAW,WAAW"}},
    {"offset": {"line": 573, "column": 0}, "map": {"version":3,"sources":["file:///Users/rajeshbyreddy/nitminer/client/src/app/api/admin/payments/route.ts"],"sourcesContent":["import { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/app/api/auth/[...nextauth]/route';\nimport dbConnect from '@/lib/dbConnect';\nimport { Payment } from '@/models/Payment';\nimport { User } from '@/models/User';\nimport { NextRequest, NextResponse } from 'next/server';\n\nexport async function GET(req: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n\n    if (!session?.user?.id || session.user.role !== 'admin') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    await dbConnect();\n\n    const { searchParams } = new URL(req.url);\n    const page = parseInt(searchParams.get('page') || '1');\n    const limit = parseInt(searchParams.get('limit') || '10');\n    const search = searchParams.get('search') || '';\n    const status = searchParams.get('status') || '';\n    const skip = (page - 1) * limit;\n\n    const query: any = {};\n    if (search) {\n      // Find users matching the search\n      const users = await User.find({\n        $or: [\n          { name: { $regex: search, $options: 'i' } },\n          { email: { $regex: search, $options: 'i' } },\n        ]\n      }).select('_id');\n\n      query.userId = { $in: users.map(u => u._id) };\n    }\n\n    if (status) {\n      query.status = status;\n    }\n\n    const payments = await Payment.find(query)\n      .populate('userId', 'name email')\n      .sort({ createdAt: -1 })\n      .skip(skip)\n      .limit(limit)\n      .lean();\n\n    const total = await Payment.countDocuments(query);\n    const totalPages = Math.ceil(total / limit);\n\n    // Calculate total revenue and successful payments count\n    const revenueResult = await Payment.aggregate([\n      { $match: { status: 'success' } },\n      { $group: { _id: null, total: { $sum: '$amount' }, count: { $sum: 1 } } }\n    ]);\n\n    const totalRevenue = revenueResult.length > 0 ? revenueResult[0].total : 0;\n    const successfulPaymentsCount = revenueResult.length > 0 ? revenueResult[0].count : 0;\n\n    return NextResponse.json({\n      payments,\n      pagination: {\n        currentPage: page,\n        totalPages,\n        totalPayments: total,\n        hasNext: page < totalPages,\n        hasPrev: page > 1\n      },\n      totalRevenue,\n      successfulPaymentsCount\n    });\n  } catch (error) {\n    console.error('Admin payments error:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;AAEO,eAAe,IAAI,GAAgB;IACxC,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,mKAAgB,EAAC,yKAAW;QAElD,IAAI,CAAC,SAAS,MAAM,MAAM,QAAQ,IAAI,CAAC,IAAI,KAAK,SAAS;YACvD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,IAAA,oIAAS;QAEf,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;QACxC,MAAM,OAAO,SAAS,aAAa,GAAG,CAAC,WAAW;QAClD,MAAM,QAAQ,SAAS,aAAa,GAAG,CAAC,YAAY;QACpD,MAAM,SAAS,aAAa,GAAG,CAAC,aAAa;QAC7C,MAAM,SAAS,aAAa,GAAG,CAAC,aAAa;QAC7C,MAAM,OAAO,CAAC,OAAO,CAAC,IAAI;QAE1B,MAAM,QAAa,CAAC;QACpB,IAAI,QAAQ;YACV,iCAAiC;YACjC,MAAM,QAAQ,MAAM,+HAAI,CAAC,IAAI,CAAC;gBAC5B,KAAK;oBACH;wBAAE,MAAM;4BAAE,QAAQ;4BAAQ,UAAU;wBAAI;oBAAE;oBAC1C;wBAAE,OAAO;4BAAE,QAAQ;4BAAQ,UAAU;wBAAI;oBAAE;iBAC5C;YACH,GAAG,MAAM,CAAC;YAEV,MAAM,MAAM,GAAG;gBAAE,KAAK,MAAM,GAAG,CAAC,CAAA,IAAK,EAAE,GAAG;YAAE;QAC9C;QAEA,IAAI,QAAQ;YACV,MAAM,MAAM,GAAG;QACjB;QAEA,MAAM,WAAW,MAAM,qIAAO,CAAC,IAAI,CAAC,OACjC,QAAQ,CAAC,UAAU,cACnB,IAAI,CAAC;YAAE,WAAW,CAAC;QAAE,GACrB,IAAI,CAAC,MACL,KAAK,CAAC,OACN,IAAI;QAEP,MAAM,QAAQ,MAAM,qIAAO,CAAC,cAAc,CAAC;QAC3C,MAAM,aAAa,KAAK,IAAI,CAAC,QAAQ;QAErC,wDAAwD;QACxD,MAAM,gBAAgB,MAAM,qIAAO,CAAC,SAAS,CAAC;YAC5C;gBAAE,QAAQ;oBAAE,QAAQ;gBAAU;YAAE;YAChC;gBAAE,QAAQ;oBAAE,KAAK;oBAAM,OAAO;wBAAE,MAAM;oBAAU;oBAAG,OAAO;wBAAE,MAAM;oBAAE;gBAAE;YAAE;SACzE;QAED,MAAM,eAAe,cAAc,MAAM,GAAG,IAAI,aAAa,CAAC,EAAE,CAAC,KAAK,GAAG;QACzE,MAAM,0BAA0B,cAAc,MAAM,GAAG,IAAI,aAAa,CAAC,EAAE,CAAC,KAAK,GAAG;QAEpF,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB;YACA,YAAY;gBACV,aAAa;gBACb;gBACA,eAAe;gBACf,SAAS,OAAO;gBAChB,SAAS,OAAO;YAClB;YACA;YACA;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}