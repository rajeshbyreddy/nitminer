{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///Users/rajeshbyreddy/nitminer/client/src/lib/dbConnect.ts"],"sourcesContent":["import mongoose from 'mongoose';\n\nconst MONGODB_URI = process.env.MONGODB_URI;\n\nif (!MONGODB_URI) {\n  throw new Error('Please define the MONGODB_URI environment variable');\n}\n\ninterface Cached {\n  conn: typeof mongoose | null;\n  promise: Promise<typeof mongoose> | null;\n}\n\nlet cached: Cached = (global as any).mongoose || { conn: null, promise: null };\n\nif (!cached) {\n  cached = (global as any).mongoose = { conn: null, promise: null };\n}\n\nasync function dbConnect() {\n  if (cached.conn) {\n    return cached.conn;\n  }\n\n  if (!cached.promise) {\n    const opts = {\n      bufferCommands: false,\n    };\n\n    cached.promise = mongoose.connect(MONGODB_URI!, opts).then((mongoose) => {\n      return mongoose;\n    });\n  }\n\n  try {\n    cached.conn = await cached.promise;\n  } catch (e) {\n    cached.promise = null;\n    throw e;\n  }\n\n  return cached.conn;\n}\n\nexport default dbConnect;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MAAM;AAClB;AAOA,IAAI,SAAiB,yDAAgB,QAAQ,IAAI;IAAE,MAAM;IAAM,SAAS;AAAK;AAE7E,IAAI,CAAC,QAAQ;IACX,SAAS,yDAAgB,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAClE;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,OAAO,OAAO,GAAG,mKAAQ,CAAC,OAAO,CAAC,aAAc,MAAM,IAAI,CAAC,CAAC;YAC1D,OAAO;QACT;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB;uCAEe"}},
    {"offset": {"line": 151, "column": 0}, "map": {"version":3,"sources":["file:///Users/rajeshbyreddy/nitminer/client/src/models/User.ts"],"sourcesContent":["import mongoose, { Schema, Document } from 'mongoose';\n\nexport interface IUser extends Document {\n  name: string;\n  email: string;\n  password?: string;\n  googleId?: string;\n  role: 'user' | 'admin';\n  trialCount: number;\n  isPremium: boolean;\n  subscriptionExpiry: Date | null;\n  subscription?: {\n    plan: '1_month' | '6_months' | '12_months';\n    status: 'active' | 'expired' | 'cancelled';\n    startDate: Date;\n    endDate: Date;\n    paymentId: mongoose.Types.ObjectId;\n  };\n  settings?: {\n    emailNotifications: boolean;\n    pushNotifications: boolean;\n    marketingEmails: boolean;\n    theme: string;\n    language: string;\n    timezone: string;\n    twoFactorAuth: boolean;\n  };\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst userSchema = new Schema<IUser>(\n  {\n    name: {\n      type: String,\n      required: true,\n      trim: true,\n    },\n    email: {\n      type: String,\n      required: true,\n      unique: true,\n      lowercase: true,\n      trim: true,\n    },\n    password: {\n      type: String,\n      select: false, // Don't return password by default\n    },\n    googleId: {\n      type: String,\n      unique: true,\n      sparse: true, // Allow null values for non-Google users\n    },\n    role: {\n      type: String,\n      enum: ['user', 'admin'],\n      default: 'user',\n    },\n    trialCount: {\n      type: Number,\n      default: 5,\n      min: 0,\n    },\n    isPremium: {\n      type: Boolean,\n      default: false,\n    },\n    subscriptionExpiry: {\n      type: Date,\n      default: null,\n    },\n    subscription: {\n      plan: {\n        type: String,\n        enum: ['1_month', '6_months', '12_months'],\n      },\n      status: {\n        type: String,\n        enum: ['active', 'expired', 'cancelled'],\n        default: 'active',\n      },\n      startDate: {\n        type: Date,\n      },\n      endDate: {\n        type: Date,\n      },\n      paymentId: {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'Payment',\n      },\n    },\n    settings: {\n      emailNotifications: {\n        type: Boolean,\n        default: true,\n      },\n      pushNotifications: {\n        type: Boolean,\n        default: false,\n      },\n      marketingEmails: {\n        type: Boolean,\n        default: false,\n      },\n      theme: {\n        type: String,\n        enum: ['dark', 'light', 'auto'],\n        default: 'dark',\n      },\n      language: {\n        type: String,\n        default: 'en',\n      },\n      timezone: {\n        type: String,\n        default: 'UTC',\n      },\n      twoFactorAuth: {\n        type: Boolean,\n        default: false,\n      },\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Index for faster queries\nuserSchema.index({ isPremium: 1 });\n\nexport const User = mongoose.models.User || mongoose.model<IUser>('User', userSchema);\n"],"names":[],"mappings":";;;;AAAA;;AA+BA,MAAM,aAAa,IAAI,kKAAM,CAC3B;IACE,MAAM;QACJ,MAAM;QACN,UAAU;QACV,MAAM;IACR;IACA,OAAO;QACL,MAAM;QACN,UAAU;QACV,QAAQ;QACR,WAAW;QACX,MAAM;IACR;IACA,UAAU;QACR,MAAM;QACN,QAAQ;IACV;IACA,UAAU;QACR,MAAM;QACN,QAAQ;QACR,QAAQ;IACV;IACA,MAAM;QACJ,MAAM;QACN,MAAM;YAAC;YAAQ;SAAQ;QACvB,SAAS;IACX;IACA,YAAY;QACV,MAAM;QACN,SAAS;QACT,KAAK;IACP;IACA,WAAW;QACT,MAAM;QACN,SAAS;IACX;IACA,oBAAoB;QAClB,MAAM;QACN,SAAS;IACX;IACA,cAAc;QACZ,MAAM;YACJ,MAAM;YACN,MAAM;gBAAC;gBAAW;gBAAY;aAAY;QAC5C;QACA,QAAQ;YACN,MAAM;YACN,MAAM;gBAAC;gBAAU;gBAAW;aAAY;YACxC,SAAS;QACX;QACA,WAAW;YACT,MAAM;QACR;QACA,SAAS;YACP,MAAM;QACR;QACA,WAAW;YACT,MAAM,mKAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;YACpC,KAAK;QACP;IACF;IACA,UAAU;QACR,oBAAoB;YAClB,MAAM;YACN,SAAS;QACX;QACA,mBAAmB;YACjB,MAAM;YACN,SAAS;QACX;QACA,iBAAiB;YACf,MAAM;YACN,SAAS;QACX;QACA,OAAO;YACL,MAAM;YACN,MAAM;gBAAC;gBAAQ;gBAAS;aAAO;YAC/B,SAAS;QACX;QACA,UAAU;YACR,MAAM;YACN,SAAS;QACX;QACA,UAAU;YACR,MAAM;YACN,SAAS;QACX;QACA,eAAe;YACb,MAAM;YACN,SAAS;QACX;IACF;AACF,GACA;IACE,YAAY;AACd;AAGF,2BAA2B;AAC3B,WAAW,KAAK,CAAC;IAAE,WAAW;AAAE;AAEzB,MAAM,OAAO,mKAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,mKAAQ,CAAC,KAAK,CAAQ,QAAQ"}},
    {"offset": {"line": 276, "column": 0}, "map": {"version":3,"sources":["file:///Users/rajeshbyreddy/nitminer/client/src/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["import NextAuth, { type NextAuthOptions, type DefaultSession } from 'next-auth';\nimport CredentialsProvider from 'next-auth/providers/credentials';\nimport GoogleProvider from 'next-auth/providers/google';\nimport bcrypt from 'bcryptjs';\nimport dbConnect from '@/lib/dbConnect';\nimport { User } from '@/models/User';\n\ndeclare module 'next-auth' {\n  interface Session extends DefaultSession {\n    user: {\n      id: string;\n      role: string;\n    } & DefaultSession['user'];\n  }\n}\n\ndeclare module 'next-auth/jwt' {\n  interface JWT {\n    id?: string;\n    role?: string;\n  }\n}\n\nexport const authOptions: NextAuthOptions = {\n  providers: [\n    GoogleProvider({\n      clientId: process.env.GOOGLE_CLIENT_ID || '',\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET || '',\n    }),\n    CredentialsProvider({\n      name: 'Credentials',\n      credentials: {\n        email: { label: 'Email', type: 'email' },\n        password: { label: 'Password', type: 'password' },\n      },\n      async authorize(credentials) {\n        try {\n          console.log('Authorize called with:', { email: credentials?.email, hasPassword: !!credentials?.password });\n          if (!credentials?.email || !credentials?.password) {\n            console.log('Missing credentials');\n            return null;\n          }\n\n          // Demo admin credentials - check/create admin user\n          if (credentials.email === 'admin@nitminer.com' && credentials.password === '12345678') {\n            console.log('Admin login attempt');\n            await dbConnect();\n\n            let adminUser = await User.findOne({ email: 'admin@nitminer.com' });\n\n            if (!adminUser) {\n              console.log('Creating admin user');\n              // Create demo admin user if it doesn't exist\n              adminUser = new User({\n                name: 'Demo Admin',\n                email: 'admin@nitminer.com',\n                password: await bcrypt.hash('12345678', 12),\n                role: 'admin',\n                subscription: 'free',\n                isActive: true,\n              });\n              await adminUser.save();\n              console.log('Admin user created');\n            } else {\n              console.log('Admin user found');\n            }\n\n            return {\n              id: adminUser._id.toString(),\n              email: adminUser.email,\n              name: adminUser.name,\n              role: adminUser.role,\n            };\n          }\n\n          console.log('Regular user login');\n          await dbConnect();\n\n          const user = await User.findOne({ email: credentials.email }).select('+password');\n\n          if (!user) {\n            console.log('User not found');\n            return null;\n          }\n\n          if (!user.password) {\n            console.log('User has no password');\n            return null;\n          }\n\n          const isPasswordValid = await bcrypt.compare(credentials.password, user.password);\n\n          if (!isPasswordValid) {\n            console.log('Invalid password');\n            return null;\n          }\n\n          console.log('Login successful');\n          return {\n            id: user._id.toString(),\n            email: user.email,\n            name: user.name,\n            role: user.role,\n          };\n        } catch (error) {\n          console.error('Auth error:', error);\n          return null;\n        }\n      },\n    }),\n  ],\n  pages: {\n    signIn: '/login',\n  },\n  callbacks: {\n    async signIn({ user, account, profile, email, credentials }) {\n      // Allow sign in for all users\n      return true;\n    },\n    async redirect({ url, baseUrl }) {\n      // If the URL is relative, prepend the base URL\n      if (url.startsWith('/')) return `${baseUrl}${url}`;\n\n      // If the URL is already absolute, allow it\n      if (new URL(url).origin === baseUrl) return url;\n\n      // Default to home page\n      return baseUrl;\n    },\n    async jwt({ token, user, account }: any) {\n      if (user) {\n        token.id = user.id;\n        token.role = user.role;\n      }\n\n      // Handle legacy \"demo-admin\" ID in existing tokens\n      if (token.id === 'demo-admin') {\n        try {\n          await dbConnect();\n          const adminUser = await User.findOne({ email: 'admin@nitminer.com' });\n          if (adminUser) {\n            token.id = adminUser._id.toString();\n            token.role = adminUser.role;\n          }\n        } catch (error) {\n          console.error('Error updating legacy admin token:', error);\n        }\n      }\n\n      // Handle Google Sign-In\n      if (account?.provider === 'google') {\n        try {\n          await dbConnect();\n\n          let dbUser = await User.findOne({ googleId: token.sub });\n\n          if (!dbUser) {\n            // Create new user from Google\n            dbUser = await User.create({\n              name: token.name,\n              email: token.email,\n              googleId: token.sub,\n              role: 'user',\n              trialCount: 5,\n            });\n          }\n\n          token.id = dbUser._id.toString();\n          token.role = dbUser.role;\n        } catch (error) {\n          console.error('Google auth error:', error);\n          // Don't fail the auth, just use default values\n        }\n      }\n\n      return token;\n    },\n    async session({ session, token }: any) {\n      if (session.user) {\n        // Handle legacy \"demo-admin\" ID\n        if (token.id === 'demo-admin') {\n          try {\n            await dbConnect();\n            const adminUser = await User.findOne({ email: 'admin@nitminer.com' });\n            if (adminUser) {\n              session.user.id = adminUser._id.toString();\n              session.user.role = adminUser.role;\n            } else {\n              // If no admin user exists, force logout\n              session.user.id = null;\n              session.user.role = null;\n            }\n          } catch (error) {\n            console.error('Error handling legacy admin ID:', error);\n            session.user.id = null;\n            session.user.role = null;\n          }\n        } else {\n          session.user.id = token.id as string;\n          session.user.role = token.role as string;\n        }\n      }\n      return session;\n    },\n  },\n  session: {\n    strategy: 'jwt',\n    maxAge: 30 * 24 * 60 * 60, // 30 days\n  },\n  jwt: {\n    secret: process.env.NEXTAUTH_SECRET,\n    maxAge: 30 * 24 * 60 * 60, // 30 days\n  },\n  debug: false,\n};\n\nconst handler = NextAuth(authOptions);\nexport { handler as GET, handler as POST };\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;AAkBO,MAAM,cAA+B;IAC1C,WAAW;QACT,IAAA,gKAAc,EAAC;YACb,UAAU,QAAQ,GAAG,CAAC,gBAAgB,IAAI;YAC1C,cAAc,QAAQ,GAAG,CAAC,oBAAoB,IAAI;QACpD;QACA,IAAA,qKAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAQ;gBACvC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW;gBACzB,IAAI;oBACF,QAAQ,GAAG,CAAC,0BAA0B;wBAAE,OAAO,aAAa;wBAAO,aAAa,CAAC,CAAC,aAAa;oBAAS;oBACxG,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU;wBACjD,QAAQ,GAAG,CAAC;wBACZ,OAAO;oBACT;oBAEA,mDAAmD;oBACnD,IAAI,YAAY,KAAK,KAAK,wBAAwB,YAAY,QAAQ,KAAK,YAAY;wBACrF,QAAQ,GAAG,CAAC;wBACZ,MAAM,IAAA,oIAAS;wBAEf,IAAI,YAAY,MAAM,+HAAI,CAAC,OAAO,CAAC;4BAAE,OAAO;wBAAqB;wBAEjE,IAAI,CAAC,WAAW;4BACd,QAAQ,GAAG,CAAC;4BACZ,6CAA6C;4BAC7C,YAAY,IAAI,+HAAI,CAAC;gCACnB,MAAM;gCACN,OAAO;gCACP,UAAU,MAAM,8IAAM,CAAC,IAAI,CAAC,YAAY;gCACxC,MAAM;gCACN,cAAc;gCACd,UAAU;4BACZ;4BACA,MAAM,UAAU,IAAI;4BACpB,QAAQ,GAAG,CAAC;wBACd,OAAO;4BACL,QAAQ,GAAG,CAAC;wBACd;wBAEA,OAAO;4BACL,IAAI,UAAU,GAAG,CAAC,QAAQ;4BAC1B,OAAO,UAAU,KAAK;4BACtB,MAAM,UAAU,IAAI;4BACpB,MAAM,UAAU,IAAI;wBACtB;oBACF;oBAEA,QAAQ,GAAG,CAAC;oBACZ,MAAM,IAAA,oIAAS;oBAEf,MAAM,OAAO,MAAM,+HAAI,CAAC,OAAO,CAAC;wBAAE,OAAO,YAAY,KAAK;oBAAC,GAAG,MAAM,CAAC;oBAErE,IAAI,CAAC,MAAM;wBACT,QAAQ,GAAG,CAAC;wBACZ,OAAO;oBACT;oBAEA,IAAI,CAAC,KAAK,QAAQ,EAAE;wBAClB,QAAQ,GAAG,CAAC;wBACZ,OAAO;oBACT;oBAEA,MAAM,kBAAkB,MAAM,8IAAM,CAAC,OAAO,CAAC,YAAY,QAAQ,EAAE,KAAK,QAAQ;oBAEhF,IAAI,CAAC,iBAAiB;wBACpB,QAAQ,GAAG,CAAC;wBACZ,OAAO;oBACT;oBAEA,QAAQ,GAAG,CAAC;oBACZ,OAAO;wBACL,IAAI,KAAK,GAAG,CAAC,QAAQ;wBACrB,OAAO,KAAK,KAAK;wBACjB,MAAM,KAAK,IAAI;wBACf,MAAM,KAAK,IAAI;oBACjB;gBACF,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,eAAe;oBAC7B,OAAO;gBACT;YACF;QACF;KACD;IACD,OAAO;QACL,QAAQ;IACV;IACA,WAAW;QACT,MAAM,QAAO,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,WAAW,EAAE;YACzD,8BAA8B;YAC9B,OAAO;QACT;QACA,MAAM,UAAS,EAAE,GAAG,EAAE,OAAO,EAAE;YAC7B,+CAA+C;YAC/C,IAAI,IAAI,UAAU,CAAC,MAAM,OAAO,GAAG,UAAU,KAAK;YAElD,2CAA2C;YAC3C,IAAI,IAAI,IAAI,KAAK,MAAM,KAAK,SAAS,OAAO;YAE5C,uBAAuB;YACvB,OAAO;QACT;QACA,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE,OAAO,EAAO;YACrC,IAAI,MAAM;gBACR,MAAM,EAAE,GAAG,KAAK,EAAE;gBAClB,MAAM,IAAI,GAAG,KAAK,IAAI;YACxB;YAEA,mDAAmD;YACnD,IAAI,MAAM,EAAE,KAAK,cAAc;gBAC7B,IAAI;oBACF,MAAM,IAAA,oIAAS;oBACf,MAAM,YAAY,MAAM,+HAAI,CAAC,OAAO,CAAC;wBAAE,OAAO;oBAAqB;oBACnE,IAAI,WAAW;wBACb,MAAM,EAAE,GAAG,UAAU,GAAG,CAAC,QAAQ;wBACjC,MAAM,IAAI,GAAG,UAAU,IAAI;oBAC7B;gBACF,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,sCAAsC;gBACtD;YACF;YAEA,wBAAwB;YACxB,IAAI,SAAS,aAAa,UAAU;gBAClC,IAAI;oBACF,MAAM,IAAA,oIAAS;oBAEf,IAAI,SAAS,MAAM,+HAAI,CAAC,OAAO,CAAC;wBAAE,UAAU,MAAM,GAAG;oBAAC;oBAEtD,IAAI,CAAC,QAAQ;wBACX,8BAA8B;wBAC9B,SAAS,MAAM,+HAAI,CAAC,MAAM,CAAC;4BACzB,MAAM,MAAM,IAAI;4BAChB,OAAO,MAAM,KAAK;4BAClB,UAAU,MAAM,GAAG;4BACnB,MAAM;4BACN,YAAY;wBACd;oBACF;oBAEA,MAAM,EAAE,GAAG,OAAO,GAAG,CAAC,QAAQ;oBAC9B,MAAM,IAAI,GAAG,OAAO,IAAI;gBAC1B,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,sBAAsB;gBACpC,+CAA+C;gBACjD;YACF;YAEA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAO;YACnC,IAAI,QAAQ,IAAI,EAAE;gBAChB,gCAAgC;gBAChC,IAAI,MAAM,EAAE,KAAK,cAAc;oBAC7B,IAAI;wBACF,MAAM,IAAA,oIAAS;wBACf,MAAM,YAAY,MAAM,+HAAI,CAAC,OAAO,CAAC;4BAAE,OAAO;wBAAqB;wBACnE,IAAI,WAAW;4BACb,QAAQ,IAAI,CAAC,EAAE,GAAG,UAAU,GAAG,CAAC,QAAQ;4BACxC,QAAQ,IAAI,CAAC,IAAI,GAAG,UAAU,IAAI;wBACpC,OAAO;4BACL,wCAAwC;4BACxC,QAAQ,IAAI,CAAC,EAAE,GAAG;4BAClB,QAAQ,IAAI,CAAC,IAAI,GAAG;wBACtB;oBACF,EAAE,OAAO,OAAO;wBACd,QAAQ,KAAK,CAAC,mCAAmC;wBACjD,QAAQ,IAAI,CAAC,EAAE,GAAG;wBAClB,QAAQ,IAAI,CAAC,IAAI,GAAG;oBACtB;gBACF,OAAO;oBACL,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;oBAC1B,QAAQ,IAAI,CAAC,IAAI,GAAG,MAAM,IAAI;gBAChC;YACF;YACA,OAAO;QACT;IACF;IACA,SAAS;QACP,UAAU;QACV,QAAQ,KAAK,KAAK,KAAK;IACzB;IACA,KAAK;QACH,QAAQ,QAAQ,GAAG,CAAC,eAAe;QACnC,QAAQ,KAAK,KAAK,KAAK;IACzB;IACA,OAAO;AACT;AAEA,MAAM,UAAU,IAAA,kJAAQ,EAAC"}},
    {"offset": {"line": 494, "column": 0}, "map": {"version":3,"sources":["file:///Users/rajeshbyreddy/nitminer/client/src/models/Payment.ts"],"sourcesContent":["import mongoose, { Schema, Document } from 'mongoose';\n\nexport interface IPayment extends Document {\n  userId: mongoose.Types.ObjectId;\n  plan: '1_month' | '6_months' | '12_months';\n  amount: number;\n  paymentMethod: 'razorpay' | 'card' | 'upi';\n  paymentId: string;\n  orderId?: string;\n  invoiceUrl?: string;\n  status: 'success' | 'pending' | 'failed';\n  completedAt?: Date;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst paymentSchema = new Schema<IPayment>(\n  {\n    userId: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: true,\n    },\n    plan: {\n      type: String,\n      enum: ['1_month', '6_months', '12_months'],\n      required: true,\n    },\n    amount: {\n      type: Number,\n      required: true,\n    },\n    paymentMethod: {\n      type: String,\n      enum: ['razorpay', 'card', 'upi'],\n      required: true,\n    },\n    paymentId: {\n      type: String,\n      required: true,\n      unique: true,\n    },\n    orderId: {\n      type: String,\n      unique: true,\n      sparse: true,\n    },\n    invoiceUrl: {\n      type: String,\n      default: null,\n    },\n    status: {\n      type: String,\n      enum: ['success', 'pending', 'failed'],\n      default: 'pending',\n    },\n    completedAt: {\n      type: Date,\n      default: null,\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Index for faster queries\npaymentSchema.index({ userId: 1 });\npaymentSchema.index({ status: 1 });\npaymentSchema.index({ createdAt: -1 });\n\nexport const Payment = mongoose.models.Payment || mongoose.model<IPayment>('Payment', paymentSchema);\n"],"names":[],"mappings":";;;;AAAA;;AAgBA,MAAM,gBAAgB,IAAI,kKAAM,CAC9B;IACE,QAAQ;QACN,MAAM,mKAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QACpC,KAAK;QACL,UAAU;IACZ;IACA,MAAM;QACJ,MAAM;QACN,MAAM;YAAC;YAAW;YAAY;SAAY;QAC1C,UAAU;IACZ;IACA,QAAQ;QACN,MAAM;QACN,UAAU;IACZ;IACA,eAAe;QACb,MAAM;QACN,MAAM;YAAC;YAAY;YAAQ;SAAM;QACjC,UAAU;IACZ;IACA,WAAW;QACT,MAAM;QACN,UAAU;QACV,QAAQ;IACV;IACA,SAAS;QACP,MAAM;QACN,QAAQ;QACR,QAAQ;IACV;IACA,YAAY;QACV,MAAM;QACN,SAAS;IACX;IACA,QAAQ;QACN,MAAM;QACN,MAAM;YAAC;YAAW;YAAW;SAAS;QACtC,SAAS;IACX;IACA,aAAa;QACX,MAAM;QACN,SAAS;IACX;AACF,GACA;IACE,YAAY;AACd;AAGF,2BAA2B;AAC3B,cAAc,KAAK,CAAC;IAAE,QAAQ;AAAE;AAChC,cAAc,KAAK,CAAC;IAAE,QAAQ;AAAE;AAChC,cAAc,KAAK,CAAC;IAAE,WAAW,CAAC;AAAE;AAE7B,MAAM,UAAU,mKAAQ,CAAC,MAAM,CAAC,OAAO,IAAI,mKAAQ,CAAC,KAAK,CAAW,WAAW"}},
    {"offset": {"line": 611, "column": 0}, "map": {"version":3,"sources":["file:///Users/rajeshbyreddy/nitminer/client/src/lib/receiptGenerator.ts"],"sourcesContent":["/**\n * HTML-based PDF Receipt Generator\n * Generates professional receipts using HTML/CSS templates\n */\n\nimport puppeteer from 'puppeteer';\n\ninterface ReceiptData {\n  receiptNumber: string;\n  receiptDate: string;\n  customerName: string;\n  customerEmail: string;\n  customerId: string;\n  serviceDescription: string;\n  amountInRupees: number;\n  paymentMethod: string;\n  transactionId: string;\n  serviceStartDate: string;\n  serviceEndDate: string;\n  paymentStatus: string;\n  duration: number;\n}\n\nfunction generateReceiptHTML(data: ReceiptData): string {\n  const formattedAmount = (data.amountInRupees / 100).toLocaleString('en-IN', {\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2,\n  });\n\n  return `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Payment Receipt - TrustInn</title>\n    <style>\n        @page {\n            size: A4;\n            margin: 0;\n        }\n\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            font-family: 'Arial', sans-serif;\n            background: #f5f5f5;\n            padding: 0;\n        }\n\n        .receipt {\n            width: 100%;\n            max-width: 900px;\n            background: white;\n            padding: 30px;\n            box-sizing: border-box;\n        }\n\n        .header {\n            display: flex;\n            align-items: center;\n            gap: 15px;\n            margin-bottom: 30px;\n            padding-bottom: 20px;\n            border-bottom: 3px solid #667eea;\n        }\n\n        .logo {\n            width: 70px;\n            height: 70px;\n            background: #667eea;\n            border-radius: 8px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            color: white;\n            font-weight: bold;\n            font-size: 24px;\n        }\n\n        .company-info h1 {\n            color: #667eea;\n            font-size: 28px;\n            font-weight: bold;\n            margin-bottom: 5px;\n        }\n\n        .company-info p {\n            color: #666;\n            font-size: 13px;\n            margin: 2px 0;\n        }\n\n        .receipt-title {\n            text-align: center;\n            margin: 30px 0;\n        }\n\n        .receipt-title h2 {\n            font-size: 26px;\n            color: #333;\n            margin-bottom: 10px;\n        }\n\n        .receipt-meta {\n            display: flex;\n            justify-content: space-between;\n            color: #666;\n            font-size: 12px;\n            gap: 30px;\n        }\n\n        .divider {\n            height: 2px;\n            background: #e0e0e0;\n            margin: 25px 0;\n        }\n\n        .section {\n            margin-bottom: 25px;\n        }\n\n        .section-title {\n            font-size: 15px;\n            font-weight: bold;\n            color: #333;\n            margin-bottom: 12px;\n            padding-bottom: 8px;\n            border-bottom: 2px solid #667eea;\n        }\n\n        .customer-info {\n            background: #f8f9fa;\n            padding: 12px;\n            border-radius: 6px;\n        }\n\n        .customer-info p {\n            font-size: 13px;\n            color: #333;\n            margin-bottom: 4px;\n        }\n\n        .customer-info strong {\n            color: #667eea;\n            font-weight: bold;\n        }\n\n        table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-top: 12px;\n        }\n\n        thead {\n            background: #667eea;\n            color: white;\n        }\n\n        thead th {\n            padding: 10px;\n            text-align: left;\n            font-size: 12px;\n            font-weight: bold;\n        }\n\n        tbody tr {\n            border-bottom: 1px solid #e0e0e0;\n        }\n\n        tbody tr:nth-child(even) {\n            background: #f8f9fa;\n        }\n\n        tbody td {\n            padding: 10px;\n            font-size: 12px;\n            color: #333;\n        }\n\n        tbody td:first-child {\n            color: #666;\n            font-weight: 500;\n        }\n\n        tbody td:last-child {\n            font-weight: bold;\n            color: #333;\n        }\n\n        .total-section {\n            margin-top: 25px;\n            text-align: right;\n        }\n\n        .total-box {\n            display: inline-block;\n            background: #667eea;\n            color: white;\n            padding: 15px 35px;\n            border-radius: 6px;\n        }\n\n        .total-box p {\n            font-size: 12px;\n            margin-bottom: 5px;\n            opacity: 0.9;\n        }\n\n        .total-box h3 {\n            font-size: 22px;\n            font-weight: bold;\n        }\n\n        .footer {\n            margin-top: 40px;\n            padding-top: 15px;\n            border-top: 2px solid #e0e0e0;\n            text-align: center;\n        }\n\n        .footer p {\n            color: #666;\n            font-size: 12px;\n            margin-bottom: 4px;\n        }\n\n        .footer .thank-you {\n            font-size: 14px;\n            color: #667eea;\n            font-weight: bold;\n            margin-bottom: 8px;\n        }\n\n        .footer .company-contact {\n            font-size: 11px;\n            color: #999;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"receipt\">\n        <!-- Header -->\n        <div class=\"header\">\n            <div class=\"logo\">\n                <img src=\"https://nitminer.com/logo_img/logo-rbg.png\" alt=\"NIT Miner Logo\" class=\"logo\">\n            </div>\n            <div class=\"company-info\">\n                <h1>TRUSTINN</h1>\n                <p>Premium Tool Platform</p>\n                <p>www.trustinn.com | support@trustinn.com</p>\n            </div>\n        </div>\n\n        <!-- Receipt Title -->\n        <div class=\"receipt-title\">\n            <h2>PAYMENT RECEIPT</h2>\n            <div class=\"receipt-meta\">\n                <span>Receipt #: ${data.receiptNumber}</span>\n                <span>Date: ${data.receiptDate}</span>\n            </div>\n        </div>\n\n        <div class=\"divider\"></div>\n\n        <!-- Customer Information -->\n        <div class=\"section\">\n            <div class=\"section-title\">Customer Information</div>\n            <div class=\"customer-info\">\n                <p><strong>Name:</strong> ${data.customerName}</p>\n                <p><strong>Email:</strong> ${data.customerEmail}</p>\n                <p><strong>Customer ID:</strong> ${data.customerId}</p>\n            </div>\n        </div>\n\n        <!-- Payment Details -->\n        <div class=\"section\">\n            <div class=\"section-title\">Payment Details</div>\n            <table>\n                <thead>\n                    <tr>\n                        <th>Description</th>\n                        <th>Details</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    <tr>\n                        <td>Service Description</td>\n                        <td>${data.serviceDescription}</td>\n                    </tr>\n                    <tr>\n                        <td>Payment Amount</td>\n                        <td>‚Çπ${formattedAmount}</td>\n                    </tr>\n                    <tr>\n                        <td>Payment Method</td>\n                        <td>${data.paymentMethod}</td>\n                    </tr>\n                    <tr>\n                        <td>Transaction ID</td>\n                        <td>${data.transactionId}</td>\n                    </tr>\n                    <tr>\n                        <td>Service Start Date</td>\n                        <td>${data.serviceStartDate}</td>\n                    </tr>\n                    <tr>\n                        <td>Service End Date</td>\n                        <td>${data.serviceEndDate}</td>\n                    </tr>\n                    <tr>\n                        <td>Payment Status</td>\n                        <td><strong style=\"color: #4CAF50;\">${data.paymentStatus}</strong></td>\n                    </tr>\n                </tbody>\n            </table>\n        </div>\n\n        <!-- Total -->\n        <div class=\"total-section\">\n            <div class=\"total-box\">\n                <p>Total Amount Paid</p>\n                <h3>‚Çπ${formattedAmount}</h3>\n            </div>\n        </div>\n\n        <!-- Footer -->\n        <div class=\"footer\">\n            <p class=\"thank-you\">Thank you for upgrading to Premium!</p>\n            <p>This is an official payment receipt from TrustInn</p>\n            <p>Your premium access is now active and ready to use</p>\n            <p class=\"company-contact\">For support: support@trustinn.com | ¬© 2026 NITMiner Technologies Private Limited</p>\n        </div>\n    </div>\n</body>\n</html>`;\n}\n\nexport async function generateHTMLPDFReceiptBuffer(data: ReceiptData): Promise<Buffer> {\n  let browser;\n  try {\n    console.log('üé® Generating HTML receipt...');\n    const htmlContent = generateReceiptHTML(data);\n    console.log('‚úÖ HTML generated');\n\n    // Launch headless browser\n    browser = await puppeteer.launch({\n      headless: true,\n      args: ['--no-sandbox', '--disable-setuid-sandbox'],\n    });\n\n    const page = await browser.newPage();\n\n    // Set content\n    await page.setContent(htmlContent, { waitUntil: 'networkidle0' });\n    console.log('‚úÖ Content loaded in browser');\n\n    // Generate PDF\n    const pdfBuffer = await page.pdf({\n      format: 'A4',\n      margin: {\n        top: '0px',\n        right: '0px',\n        bottom: '0px',\n        left: '0px',\n      },\n    });\n\n    console.log(`‚úÖ PDF buffer created: ${pdfBuffer.length} bytes`);\n\n    await browser.close();\n    return Buffer.from(pdfBuffer);\n  } catch (error) {\n    if (browser) {\n      await browser.close();\n    }\n    console.error('‚ùå Error generating PDF:', error);\n    throw error;\n  }\n}"],"names":[],"mappings":";;;;AAAA;;;CAGC,GAED;;;;;;AAkBA,SAAS,oBAAoB,IAAiB;IAC5C,MAAM,kBAAkB,CAAC,KAAK,cAAc,GAAG,GAAG,EAAE,cAAc,CAAC,SAAS;QAC1E,uBAAuB;QACvB,uBAAuB;IACzB;IAEA,OAAO,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;iCAwOuB,EAAE,KAAK,aAAa,CAAC;4BAC1B,EAAE,KAAK,WAAW,CAAC;;;;;;;;;;0CAUL,EAAE,KAAK,YAAY,CAAC;2CACnB,EAAE,KAAK,aAAa,CAAC;iDACf,EAAE,KAAK,UAAU,CAAC;;;;;;;;;;;;;;;;;4BAiBvC,EAAE,KAAK,kBAAkB,CAAC;;;;6BAIzB,EAAE,gBAAgB;;;;4BAInB,EAAE,KAAK,aAAa,CAAC;;;;4BAIrB,EAAE,KAAK,aAAa,CAAC;;;;4BAIrB,EAAE,KAAK,gBAAgB,CAAC;;;;4BAIxB,EAAE,KAAK,cAAc,CAAC;;;;4DAIU,EAAE,KAAK,aAAa,CAAC;;;;;;;;;;qBAU5D,EAAE,gBAAgB;;;;;;;;;;;;;OAahC,CAAC;AACR;AAEO,eAAe,6BAA6B,IAAiB;IAClE,IAAI;IACJ,IAAI;QACF,QAAQ,GAAG,CAAC;QACZ,MAAM,cAAc,oBAAoB;QACxC,QAAQ,GAAG,CAAC;QAEZ,0BAA0B;QAC1B,UAAU,MAAM,6KAAS,CAAC,MAAM,CAAC;YAC/B,UAAU;YACV,MAAM;gBAAC;gBAAgB;aAA2B;QACpD;QAEA,MAAM,OAAO,MAAM,QAAQ,OAAO;QAElC,cAAc;QACd,MAAM,KAAK,UAAU,CAAC,aAAa;YAAE,WAAW;QAAe;QAC/D,QAAQ,GAAG,CAAC;QAEZ,eAAe;QACf,MAAM,YAAY,MAAM,KAAK,GAAG,CAAC;YAC/B,QAAQ;YACR,QAAQ;gBACN,KAAK;gBACL,OAAO;gBACP,QAAQ;gBACR,MAAM;YACR;QACF;QAEA,QAAQ,GAAG,CAAC,CAAC,sBAAsB,EAAE,UAAU,MAAM,CAAC,MAAM,CAAC;QAE7D,MAAM,QAAQ,KAAK;QACnB,OAAO,OAAO,IAAI,CAAC;IACrB,EAAE,OAAO,OAAO;QACd,IAAI,SAAS;YACX,MAAM,QAAQ,KAAK;QACrB;QACA,QAAQ,KAAK,CAAC,2BAA2B;QACzC,MAAM;IACR;AACF"}},
    {"offset": {"line": 986, "column": 0}, "map": {"version":3,"sources":["file:///Users/rajeshbyreddy/nitminer/client/src/lib/cloudinary.ts"],"sourcesContent":["import { v2 as cloudinary } from 'cloudinary';\n\n// Configure Cloudinary\ncloudinary.config({\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n  api_key: process.env.CLOUDINARY_API_KEY,\n  api_secret: process.env.CLOUDINARY_API_SECRET,\n});\n\nexport async function uploadReceiptToCloudinary(\n  buffer: Buffer,\n  fileName: string\n): Promise<string> {\n  try {\n    console.log('üì§ Uploading receipt to Cloudinary...');\n\n    // Upload buffer to Cloudinary\n    const result = await new Promise<any>((resolve, reject) => {\n      cloudinary.uploader.upload_stream(\n        {\n          resource_type: 'raw',\n          public_id: `receipts/${fileName}`,\n          format: 'pdf',\n          folder: 'trustinn/receipts',\n        },\n        (error, result) => {\n          if (error) {\n            console.error('Cloudinary upload error:', error);\n            reject(error);\n          } else {\n            resolve(result);\n          }\n        }\n      ).end(buffer);\n    });\n\n    console.log('‚úÖ Receipt uploaded to Cloudinary:', result.secure_url);\n    return result.secure_url;\n  } catch (error) {\n    console.error('‚ùå Failed to upload receipt to Cloudinary:', error);\n    throw error;\n  }\n}"],"names":[],"mappings":";;;;AAAA;;AAEA,uBAAuB;AACvB,gJAAU,CAAC,MAAM,CAAC;IAChB,YAAY,QAAQ,GAAG,CAAC,qBAAqB;IAC7C,SAAS,QAAQ,GAAG,CAAC,kBAAkB;IACvC,YAAY,QAAQ,GAAG,CAAC,qBAAqB;AAC/C;AAEO,eAAe,0BACpB,MAAc,EACd,QAAgB;IAEhB,IAAI;QACF,QAAQ,GAAG,CAAC;QAEZ,8BAA8B;QAC9B,MAAM,SAAS,MAAM,IAAI,QAAa,CAAC,SAAS;YAC9C,gJAAU,CAAC,QAAQ,CAAC,aAAa,CAC/B;gBACE,eAAe;gBACf,WAAW,CAAC,SAAS,EAAE,UAAU;gBACjC,QAAQ;gBACR,QAAQ;YACV,GACA,CAAC,OAAO;gBACN,IAAI,OAAO;oBACT,QAAQ,KAAK,CAAC,4BAA4B;oBAC1C,OAAO;gBACT,OAAO;oBACL,QAAQ;gBACV;YACF,GACA,GAAG,CAAC;QACR;QAEA,QAAQ,GAAG,CAAC,qCAAqC,OAAO,UAAU;QAClE,OAAO,OAAO,UAAU;IAC1B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6CAA6C;QAC3D,MAAM;IACR;AACF"}},
    {"offset": {"line": 1052, "column": 0}, "map": {"version":3,"sources":["file:///Users/rajeshbyreddy/nitminer/client/src/lib/email.ts"],"sourcesContent":["import nodemailer from 'nodemailer';\n\n// Configure your email service here\nconst transporter = nodemailer.createTransport({\n  host: process.env.SMTP_HOST,\n  port: parseInt(process.env.SMTP_PORT || '587'),\n  secure: process.env.SMTP_PORT === '465', // true for 465, false for other ports\n  auth: {\n    user: process.env.SMTP_USER,\n    pass: process.env.SMTP_PASSWORD,\n  },\n});\n\nexport async function sendSubscriptionExpiredEmail(email: string, name: string) {\n  try {\n    await transporter.sendMail({\n      from: process.env.SMTP_FROM,\n      to: email,\n      subject: 'Your Subscription Has Expired',\n      html: `\n        <h1>Hello ${name},</h1>\n        <p>Your premium subscription has expired. Please renew to continue using our tools without limitations.</p>\n        <p>\n          <a href=\"${process.env.NEXT_PUBLIC_API_URL}/pricing\" style=\"background-color: #3b82f6; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;\">\n            Renew Now\n          </a>\n        </p>\n        <p>If you have any questions, please contact our support team.</p>\n      `,\n    });\n    console.log(`Email sent to ${email}`);\n  } catch (error) {\n    console.error('Failed to send email:', error);\n    throw error;\n  }\n}\n\nexport async function sendWelcomeEmail(email: string, name: string) {\n  try {\n    await transporter.sendMail({\n      from: process.env.SMTP_FROM,\n      to: email,\n      subject: 'Welcome to TrustInn!',\n      html: `\n        <h1>Welcome ${name}!</h1>\n        <p>Thank you for joining TrustInn. You now have 5 free trials to explore our tools.</p>\n        <p>\n          <a href=\"${process.env.NEXT_PUBLIC_API_URL}/tools\" style=\"background-color: #3b82f6; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;\">\n            Start Using Tools\n          </a>\n        </p>\n      `,\n    });\n  } catch (error) {\n    console.error('Failed to send welcome email:', error);\n  }\n}\n\nexport async function sendOTP(email: string, otp: string) {\n  try {\n    await transporter.sendMail({\n      from: process.env.SMTP_FROM,\n      to: email,\n      subject: 'Your OTP Code - NITMiner Technologies',\n      html: `\n        <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n          <h1 style=\"color: #333;\">Your OTP Code</h1>\n          <p>Hello,</p>\n          <p>Your one-time password (OTP) for verification is:</p>\n          <div style=\"background: #f8f9fa; padding: 20px; border-radius: 5px; margin: 20px 0; text-align: center;\">\n            <h2 style=\"color: #007bff; font-size: 32px; margin: 0; letter-spacing: 5px;\">${otp}</h2>\n          </div>\n          <p>This code will expire in 10 minutes. Please do not share this code with anyone.</p>\n          <p>If you didn't request this OTP, please ignore this email.</p>\n          <hr style=\"border: none; border-top: 1px solid #eee; margin: 30px 0;\">\n          <p style=\"color: #666; font-size: 12px;\">\n            ¬© 2026 NITMiner Technologies. All rights reserved.\n          </p>\n        </div>\n      `,\n    });\n    console.log(`OTP sent to ${email}`);\n  } catch (error) {\n    console.error('Failed to send OTP:', error);\n    throw error;\n  }\n}\n\nexport async function sendPaymentSuccessEmail(email: string, name: string, amount: number, plan: string) {\n  try {\n    await transporter.sendMail({\n      from: process.env.SMTP_FROM,\n      to: email,\n      subject: 'Payment Successful - NITMiner Technologies',\n      html: `\n        <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n          <h1 style=\"color: #333;\">Payment Successful</h1>\n          <p>Hello ${name},</p>\n          <p>Thank you for your payment! Your subscription has been activated.</p>\n          <div style=\"background: #f8f9fa; padding: 20px; border-radius: 5px; margin: 20px 0;\">\n            <p><strong>Plan:</strong> ${plan}</p>\n            <p><strong>Amount:</strong> ‚Çπ${amount}</p>\n            <p><strong>Status:</strong> <span style=\"color: #28a745;\">Completed</span></p>\n          </div>\n          <p>You now have full access to all our tools and features.</p>\n          <p>\n            <a href=\"${process.env.NEXT_PUBLIC_API_URL}/dashboard\" style=\"background-color: #007bff; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;\">\n              Go to Dashboard\n            </a>\n          </p>\n          <hr style=\"border: none; border-top: 1px solid #eee; margin: 30px 0;\">\n          <p style=\"color: #666; font-size: 12px;\">\n            ¬© 2026 NITMiner Technologies. All rights reserved.\n          </p>\n        </div>\n      `,\n    });\n    console.log(`Payment confirmation sent to ${email}`);\n  } catch (error) {\n    console.error('Failed to send payment success email:', error);\n    throw error;\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAEA,oCAAoC;AACpC,MAAM,cAAc,4JAAU,CAAC,eAAe,CAAC;IAC7C,MAAM,QAAQ,GAAG,CAAC,SAAS;IAC3B,MAAM,SAAS,QAAQ,GAAG,CAAC,SAAS,IAAI;IACxC,QAAQ,QAAQ,GAAG,CAAC,SAAS,KAAK;IAClC,MAAM;QACJ,MAAM,QAAQ,GAAG,CAAC,SAAS;QAC3B,MAAM,QAAQ,GAAG,CAAC,aAAa;IACjC;AACF;AAEO,eAAe,6BAA6B,KAAa,EAAE,IAAY;IAC5E,IAAI;QACF,MAAM,YAAY,QAAQ,CAAC;YACzB,MAAM,QAAQ,GAAG,CAAC,SAAS;YAC3B,IAAI;YACJ,SAAS;YACT,MAAM,CAAC;kBACK,EAAE,KAAK;;;mBAGN,EAAE,QAAQ,GAAG,CAAC,mBAAmB,CAAC;;;;;MAK/C,CAAC;QACH;QACA,QAAQ,GAAG,CAAC,CAAC,cAAc,EAAE,OAAO;IACtC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,MAAM;IACR;AACF;AAEO,eAAe,iBAAiB,KAAa,EAAE,IAAY;IAChE,IAAI;QACF,MAAM,YAAY,QAAQ,CAAC;YACzB,MAAM,QAAQ,GAAG,CAAC,SAAS;YAC3B,IAAI;YACJ,SAAS;YACT,MAAM,CAAC;oBACO,EAAE,KAAK;;;mBAGR,EAAE,QAAQ,GAAG,CAAC,mBAAmB,CAAC;;;;MAI/C,CAAC;QACH;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;IACjD;AACF;AAEO,eAAe,QAAQ,KAAa,EAAE,GAAW;IACtD,IAAI;QACF,MAAM,YAAY,QAAQ,CAAC;YACzB,MAAM,QAAQ,GAAG,CAAC,SAAS;YAC3B,IAAI;YACJ,SAAS;YACT,MAAM,CAAC;;;;;;yFAM4E,EAAE,IAAI;;;;;;;;;MASzF,CAAC;QACH;QACA,QAAQ,GAAG,CAAC,CAAC,YAAY,EAAE,OAAO;IACpC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uBAAuB;QACrC,MAAM;IACR;AACF;AAEO,eAAe,wBAAwB,KAAa,EAAE,IAAY,EAAE,MAAc,EAAE,IAAY;IACrG,IAAI;QACF,MAAM,YAAY,QAAQ,CAAC;YACzB,MAAM,QAAQ,GAAG,CAAC,SAAS;YAC3B,IAAI;YACJ,SAAS;YACT,MAAM,CAAC;;;mBAGM,EAAE,KAAK;;;sCAGY,EAAE,KAAK;yCACJ,EAAE,OAAO;;;;;qBAK7B,EAAE,QAAQ,GAAG,CAAC,mBAAmB,CAAC;;;;;;;;;MASjD,CAAC;QACH;QACA,QAAQ,GAAG,CAAC,CAAC,6BAA6B,EAAE,OAAO;IACrD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yCAAyC;QACvD,MAAM;IACR;AACF"}},
    {"offset": {"line": 1187, "column": 0}, "map": {"version":3,"sources":["file:///Users/rajeshbyreddy/nitminer/client/src/app/api/payments/verify/route.ts"],"sourcesContent":["import { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/app/api/auth/[...nextauth]/route';\nimport dbConnect from '@/lib/dbConnect';\nimport { User } from '@/models/User';\nimport { Payment } from '@/models/Payment';\nimport Razorpay from 'razorpay';\nimport { NextRequest, NextResponse } from 'next/server';\nimport crypto from 'crypto';\nimport { generateHTMLPDFReceiptBuffer } from '@/lib/receiptGenerator';\nimport { uploadReceiptToCloudinary } from '@/lib/cloudinary';\nimport { sendPaymentSuccessEmail } from '@/lib/email';\n\nconst razorpay = new Razorpay({\n  key_id: process.env.NEXT_PUBLIC_RAZORPAY_KEY_ID!,\n  key_secret: process.env.RAZORPAY_KEY_SECRET!,\n});\n\nexport async function POST(req: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { razorpay_order_id, razorpay_payment_id, razorpay_signature } = await req.json();\n\n    if (!razorpay_order_id || !razorpay_payment_id || !razorpay_signature) {\n      return NextResponse.json({ error: 'Missing payment verification data' }, { status: 400 });\n    }\n\n    await dbConnect();\n\n    // Verify payment signature\n    const sign = razorpay_order_id + '|' + razorpay_payment_id;\n    const expectedSign = crypto\n      .createHmac('sha256', process.env.RAZORPAY_KEY_SECRET!)\n      .update(sign.toString())\n      .digest('hex');\n\n    if (razorpay_signature !== expectedSign) {\n      return NextResponse.json({ error: 'Payment verification failed' }, { status: 400 });\n    }\n\n    // Find and update payment record\n    const payment = await Payment.findOneAndUpdate(\n      { orderId: razorpay_order_id },\n      {\n        paymentId: razorpay_payment_id,\n        status: 'success',\n        completedAt: new Date(),\n      },\n      { new: true }\n    );\n\n    if (!payment) {\n      return NextResponse.json({ error: 'Payment record not found' }, { status: 404 });\n    }\n\n    // Update user subscription\n    const user = await User.findById(session.user.id);\n    if (!user) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    // Calculate subscription end date based on plan\n    const now = new Date();\n    let endDate = new Date(now);\n\n    if (payment.plan === '1_month') {\n      endDate.setMonth(now.getMonth() + 1);\n    } else if (payment.plan === '6_months') {\n      endDate.setMonth(now.getMonth() + 6);\n    } else if (payment.plan === '12_months') {\n      endDate.setFullYear(now.getFullYear() + 1);\n    }\n\n    user.isPremium = true;\n    user.subscription = {\n      plan: payment.plan,\n      status: 'active',\n      startDate: now,\n      endDate: endDate,\n      paymentId: payment._id,\n    };\n\n    await user.save();\n\n    // Generate and send receipt\n    try {\n      console.log('üßæ Generating payment receipt...');\n\n      const receiptData = {\n        receiptNumber: `RCP-${payment._id.toString().slice(-8).toUpperCase()}`,\n        receiptDate: new Date().toLocaleDateString('en-IN'),\n        customerName: user.name,\n        customerEmail: user.email,\n        customerId: user._id.toString(),\n        serviceDescription: `${payment.plan.replace('_', ' ').toUpperCase()} Premium Subscription`,\n        amountInRupees: payment.amount * 100, // Convert back to paise for display\n        paymentMethod: 'Razorpay',\n        transactionId: razorpay_payment_id,\n        serviceStartDate: user.subscription!.startDate.toLocaleDateString('en-IN'),\n        serviceEndDate: user.subscription!.endDate.toLocaleDateString('en-IN'),\n        paymentStatus: 'Success',\n        duration: payment.plan === '1_month' ? 1 : payment.plan === '6_months' ? 6 : 12,\n      };\n\n      // Generate PDF receipt\n      const pdfBuffer = await generateHTMLPDFReceiptBuffer(receiptData);\n\n      // Upload to Cloudinary\n      const fileName = `receipt-${payment._id}-${Date.now()}.pdf`;\n      const receiptUrl = await uploadReceiptToCloudinary(pdfBuffer, fileName);\n\n      // Update payment record with receipt URL\n      await Payment.findByIdAndUpdate(payment._id, {\n        invoiceUrl: receiptUrl,\n      });\n      // Send email with receipt\n      await sendPaymentSuccessEmail(\n        user.email,\n        user.name,\n        payment.amount,\n        payment.plan.replace('_', ' ').toUpperCase()\n      );\n\n      console.log('‚úÖ Receipt generated and email sent');\n    } catch (receiptError) {\n      console.error('‚ùå Error generating/sending receipt:', receiptError);\n      // Don't fail the payment verification if receipt generation fails\n    }\n\n    return NextResponse.json({\n      success: true,\n      message: 'Payment verified and subscription activated',\n      subscription: user.subscription,\n    });\n  } catch (error) {\n    console.error('Payment verification error:', error);\n    return NextResponse.json({ error: 'Failed to verify payment' }, { status: 500 });\n  }\n}"],"names":[],"mappings":"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"}}]
}