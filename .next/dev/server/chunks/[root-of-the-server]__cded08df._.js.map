{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/rajeshbyreddy/nitminer/client/src/lib/dbConnect.ts"],"sourcesContent":["import mongoose from 'mongoose';\n\nconst MONGODB_URI = process.env.MONGODB_URI;\n\nif (!MONGODB_URI) {\n  throw new Error('Please define the MONGODB_URI environment variable');\n}\n\ninterface Cached {\n  conn: typeof mongoose | null;\n  promise: Promise<typeof mongoose> | null;\n}\n\nlet cached: Cached = (global as any).mongoose || { conn: null, promise: null };\n\nif (!cached) {\n  cached = (global as any).mongoose = { conn: null, promise: null };\n}\n\nasync function dbConnect() {\n  if (cached.conn) {\n    return cached.conn;\n  }\n\n  if (!cached.promise) {\n    const opts = {\n      bufferCommands: false,\n    };\n\n    cached.promise = mongoose.connect(MONGODB_URI!, opts).then((mongoose) => {\n      return mongoose;\n    });\n  }\n\n  try {\n    cached.conn = await cached.promise;\n  } catch (e) {\n    cached.promise = null;\n    throw e;\n  }\n\n  return cached.conn;\n}\n\nexport default dbConnect;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MAAM;AAClB;AAOA,IAAI,SAAiB,yDAAgB,QAAQ,IAAI;IAAE,MAAM;IAAM,SAAS;AAAK;AAE7E,IAAI,CAAC,QAAQ;IACX,SAAS,yDAAgB,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAClE;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,OAAO,OAAO,GAAG,mKAAQ,CAAC,OAAO,CAAC,aAAc,MAAM,IAAI,CAAC,CAAC;YAC1D,OAAO;QACT;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB;uCAEe"}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///Users/rajeshbyreddy/nitminer/client/src/models/SessionManagement.ts"],"sourcesContent":["import mongoose, { Schema, Document } from 'mongoose';\n\nexport interface ISessionManagement extends Document {\n  userId: mongoose.Types.ObjectId;\n  email: string;\n  deviceId: string;\n  deviceFingerprint: string;\n  deviceName: string;\n  browser: string;\n  os: string;\n  ipAddress: string;\n  sessionToken: string;\n  isActive: boolean;\n  loginTime: Date;\n  lastActivity: Date;\n  expiresAt: Date;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst sessionManagementSchema = new Schema<ISessionManagement>(\n  {\n    userId: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: true,\n      index: true,\n    },\n    email: {\n      type: String,\n      required: true,\n      lowercase: true,\n      index: true,\n    },\n    deviceId: {\n      type: String,\n      required: true,\n      index: true,\n    },\n    deviceFingerprint: {\n      type: String,\n      required: true,\n      index: true,\n    },\n    deviceName: {\n      type: String,\n      default: 'Unknown Device',\n    },\n    browser: {\n      type: String,\n      default: 'Unknown',\n    },\n    os: {\n      type: String,\n      default: 'Unknown',\n    },\n    ipAddress: {\n      type: String,\n      default: null,\n    },\n    sessionToken: {\n      type: String,\n      required: true,\n      unique: true,\n      index: true,\n    },\n    isActive: {\n      type: Boolean,\n      default: true,\n      index: true,\n    },\n    loginTime: {\n      type: Date,\n      required: true,\n      default: () => new Date(),\n    },\n    lastActivity: {\n      type: Date,\n      required: true,\n      default: () => new Date(),\n    },\n    expiresAt: {\n      type: Date,\n      required: true,\n      default: () => new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), // 30 days\n      // TTL index configured below\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Index for finding active sessions for a user\nsessionManagementSchema.index({ userId: 1, isActive: 1 });\nsessionManagementSchema.index({ expiresAt: 1 }, { expireAfterSeconds: 0 }); // TTL index\n\nexport const SessionManagement =\n  mongoose.models.SessionManagement ||\n  mongoose.model<ISessionManagement>('SessionManagement', sessionManagementSchema);\n"],"names":[],"mappings":";;;;AAAA;;AAoBA,MAAM,0BAA0B,IAAI,kKAAM,CACxC;IACE,QAAQ;QACN,MAAM,mKAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QACpC,KAAK;QACL,UAAU;QACV,OAAO;IACT;IACA,OAAO;QACL,MAAM;QACN,UAAU;QACV,WAAW;QACX,OAAO;IACT;IACA,UAAU;QACR,MAAM;QACN,UAAU;QACV,OAAO;IACT;IACA,mBAAmB;QACjB,MAAM;QACN,UAAU;QACV,OAAO;IACT;IACA,YAAY;QACV,MAAM;QACN,SAAS;IACX;IACA,SAAS;QACP,MAAM;QACN,SAAS;IACX;IACA,IAAI;QACF,MAAM;QACN,SAAS;IACX;IACA,WAAW;QACT,MAAM;QACN,SAAS;IACX;IACA,cAAc;QACZ,MAAM;QACN,UAAU;QACV,QAAQ;QACR,OAAO;IACT;IACA,UAAU;QACR,MAAM;QACN,SAAS;QACT,OAAO;IACT;IACA,WAAW;QACT,MAAM;QACN,UAAU;QACV,SAAS,IAAM,IAAI;IACrB;IACA,cAAc;QACZ,MAAM;QACN,UAAU;QACV,SAAS,IAAM,IAAI;IACrB;IACA,WAAW;QACT,MAAM;QACN,UAAU;QACV,SAAS,IAAM,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,KAAK,KAAK;IAE3D;AACF,GACA;IACE,YAAY;AACd;AAGF,+CAA+C;AAC/C,wBAAwB,KAAK,CAAC;IAAE,QAAQ;IAAG,UAAU;AAAE;AACvD,wBAAwB,KAAK,CAAC;IAAE,WAAW;AAAE,GAAG;IAAE,oBAAoB;AAAE,IAAI,YAAY;AAEjF,MAAM,oBACX,mKAAQ,CAAC,MAAM,CAAC,iBAAiB,IACjC,mKAAQ,CAAC,KAAK,CAAqB,qBAAqB"}},
    {"offset": {"line": 180, "column": 0}, "map": {"version":3,"sources":["file:///Users/rajeshbyreddy/nitminer/client/src/models/User.ts"],"sourcesContent":["import mongoose, { Schema, Document } from 'mongoose';\n\nexport interface IUser extends Document {\n  name: string;\n  email: string;\n  password?: string;\n  googleId?: string;\n  role: 'user' | 'admin';\n  trialCount: number;\n  isPremium: boolean;\n  subscriptionExpiry: Date | null;\n  subscription?: {\n    plan: '1_month' | '6_months' | '12_months';\n    status: 'active' | 'expired' | 'cancelled';\n    startDate: Date;\n    endDate: Date;\n    paymentId: mongoose.Types.ObjectId;\n  };\n  settings?: {\n    emailNotifications: boolean;\n    pushNotifications: boolean;\n    marketingEmails: boolean;\n    theme: string;\n    language: string;\n    timezone: string;\n    twoFactorAuth: boolean;\n  };\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst userSchema = new Schema<IUser>(\n  {\n    name: {\n      type: String,\n      required: true,\n      trim: true,\n    },\n    email: {\n      type: String,\n      required: true,\n      unique: true,\n      lowercase: true,\n      trim: true,\n    },\n    password: {\n      type: String,\n      select: false, // Don't return password by default\n    },\n    googleId: {\n      type: String,\n      unique: true,\n      sparse: true, // Allow null values for non-Google users\n    },\n    role: {\n      type: String,\n      enum: ['user', 'admin'],\n      default: 'user',\n    },\n    trialCount: {\n      type: Number,\n      default: 5,\n      min: 0,\n    },\n    isPremium: {\n      type: Boolean,\n      default: false,\n    },\n    subscriptionExpiry: {\n      type: Date,\n      default: null,\n    },\n    subscription: {\n      plan: {\n        type: String,\n        enum: ['1_month', '6_months', '12_months'],\n      },\n      status: {\n        type: String,\n        enum: ['active', 'expired', 'cancelled'],\n        default: 'active',\n      },\n      startDate: {\n        type: Date,\n      },\n      endDate: {\n        type: Date,\n      },\n      paymentId: {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'Payment',\n      },\n    },\n    settings: {\n      emailNotifications: {\n        type: Boolean,\n        default: true,\n      },\n      pushNotifications: {\n        type: Boolean,\n        default: false,\n      },\n      marketingEmails: {\n        type: Boolean,\n        default: false,\n      },\n      theme: {\n        type: String,\n        enum: ['dark', 'light', 'auto'],\n        default: 'dark',\n      },\n      language: {\n        type: String,\n        default: 'en',\n      },\n      timezone: {\n        type: String,\n        default: 'UTC',\n      },\n      twoFactorAuth: {\n        type: Boolean,\n        default: false,\n      },\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Index for faster queries\nuserSchema.index({ isPremium: 1 });\n\nexport const User = mongoose.models.User || mongoose.model<IUser>('User', userSchema);\n"],"names":[],"mappings":";;;;AAAA;;AA+BA,MAAM,aAAa,IAAI,kKAAM,CAC3B;IACE,MAAM;QACJ,MAAM;QACN,UAAU;QACV,MAAM;IACR;IACA,OAAO;QACL,MAAM;QACN,UAAU;QACV,QAAQ;QACR,WAAW;QACX,MAAM;IACR;IACA,UAAU;QACR,MAAM;QACN,QAAQ;IACV;IACA,UAAU;QACR,MAAM;QACN,QAAQ;QACR,QAAQ;IACV;IACA,MAAM;QACJ,MAAM;QACN,MAAM;YAAC;YAAQ;SAAQ;QACvB,SAAS;IACX;IACA,YAAY;QACV,MAAM;QACN,SAAS;QACT,KAAK;IACP;IACA,WAAW;QACT,MAAM;QACN,SAAS;IACX;IACA,oBAAoB;QAClB,MAAM;QACN,SAAS;IACX;IACA,cAAc;QACZ,MAAM;YACJ,MAAM;YACN,MAAM;gBAAC;gBAAW;gBAAY;aAAY;QAC5C;QACA,QAAQ;YACN,MAAM;YACN,MAAM;gBAAC;gBAAU;gBAAW;aAAY;YACxC,SAAS;QACX;QACA,WAAW;YACT,MAAM;QACR;QACA,SAAS;YACP,MAAM;QACR;QACA,WAAW;YACT,MAAM,mKAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;YACpC,KAAK;QACP;IACF;IACA,UAAU;QACR,oBAAoB;YAClB,MAAM;YACN,SAAS;QACX;QACA,mBAAmB;YACjB,MAAM;YACN,SAAS;QACX;QACA,iBAAiB;YACf,MAAM;YACN,SAAS;QACX;QACA,OAAO;YACL,MAAM;YACN,MAAM;gBAAC;gBAAQ;gBAAS;aAAO;YAC/B,SAAS;QACX;QACA,UAAU;YACR,MAAM;YACN,SAAS;QACX;QACA,UAAU;YACR,MAAM;YACN,SAAS;QACX;QACA,eAAe;YACb,MAAM;YACN,SAAS;QACX;IACF;AACF,GACA;IACE,YAAY;AACd;AAGF,2BAA2B;AAC3B,WAAW,KAAK,CAAC;IAAE,WAAW;AAAE;AAEzB,MAAM,OAAO,mKAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,mKAAQ,CAAC,KAAK,CAAQ,QAAQ"}},
    {"offset": {"line": 311, "column": 0}, "map": {"version":3,"sources":["file:///Users/rajeshbyreddy/nitminer/client/src/app/api/auth/session/create/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport dbConnect from '@/lib/dbConnect';\nimport { SessionManagement } from '@/models/SessionManagement';\nimport { User } from '@/models/User';\nimport crypto from 'crypto';\n\n/**\n * POST /api/auth/session/create\n * Create a new session for the user\n */\nexport async function POST(request: NextRequest) {\n  try {\n    await dbConnect();\n\n    const body = await request.json();\n    let {\n      userId,\n      email,\n      deviceId,\n      deviceFingerprint,\n      deviceName,\n      browser,\n      os,\n    } = body;\n\n    if (!email || !deviceId || !deviceFingerprint) {\n      return NextResponse.json(\n        { error: 'Missing required fields' },\n        { status: 400 }\n      );\n    }\n\n    // If userId is email (fallback), try to find the actual user ID\n    if (!userId || userId === email) {\n      try {\n        const user = await User.findOne({ email: email.toLowerCase() });\n        if (user) {\n          userId = user._id.toString();\n        } else {\n          userId = `user_${Date.now()}`; // Fallback ID\n        }\n      } catch (err) {\n        console.log('Could not find user by email, using fallback');\n        userId = `user_${Date.now()}`;\n      }\n    }\n\n    // Get client IP\n    const ipAddress =\n      request.headers.get('x-forwarded-for')?.split(',')[0].trim() ||\n      request.headers.get('x-real-ip') ||\n      'unknown';\n\n    // Generate unique session token\n    const sessionToken = crypto.randomBytes(32).toString('hex');\n\n    // Check if user has other active sessions\n    const existingSessions = await SessionManagement.find({\n      email: email.toLowerCase(),\n      isActive: true,\n    });\n\n    console.log(`Creating session for ${email}, found ${existingSessions.length} existing sessions`);\n\n    // Invalidate all previous sessions for this email\n    if (existingSessions.length > 0) {\n      await SessionManagement.updateMany(\n        { email: email.toLowerCase(), isActive: true },\n        { isActive: false }\n      );\n      console.log(`Invalidated ${existingSessions.length} previous sessions`);\n    }\n\n    // Create new session\n    const newSession = new SessionManagement({\n      userId,\n      email: email.toLowerCase(),\n      deviceId,\n      deviceFingerprint,\n      deviceName: deviceName || 'Unknown Device',\n      browser: browser || 'Unknown',\n      os: os || 'Unknown',\n      ipAddress,\n      sessionToken,\n      isActive: true,\n      loginTime: new Date(),\n      lastActivity: new Date(),\n      expiresAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), // 30 days\n    });\n\n    await newSession.save();\n    console.log(`New session created: ${newSession._id}`);\n\n    return NextResponse.json(\n      {\n        success: true,\n        sessionToken,\n        sessionId: newSession._id,\n      },\n      { status: 201 }\n    );\n  } catch (error) {\n    console.error('Session creation error:', error);\n    return NextResponse.json(\n      { error: 'Failed to create session' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAMO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,IAAA,oIAAS;QAEf,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,IAAI,EACF,MAAM,EACN,KAAK,EACL,QAAQ,EACR,iBAAiB,EACjB,UAAU,EACV,OAAO,EACP,EAAE,EACH,GAAG;QAEJ,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,mBAAmB;YAC7C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA0B,GACnC;gBAAE,QAAQ;YAAI;QAElB;QAEA,gEAAgE;QAChE,IAAI,CAAC,UAAU,WAAW,OAAO;YAC/B,IAAI;gBACF,MAAM,OAAO,MAAM,+HAAI,CAAC,OAAO,CAAC;oBAAE,OAAO,MAAM,WAAW;gBAAG;gBAC7D,IAAI,MAAM;oBACR,SAAS,KAAK,GAAG,CAAC,QAAQ;gBAC5B,OAAO;oBACL,SAAS,CAAC,KAAK,EAAE,KAAK,GAAG,IAAI,EAAE,cAAc;gBAC/C;YACF,EAAE,OAAO,KAAK;gBACZ,QAAQ,GAAG,CAAC;gBACZ,SAAS,CAAC,KAAK,EAAE,KAAK,GAAG,IAAI;YAC/B;QACF;QAEA,gBAAgB;QAChB,MAAM,YACJ,QAAQ,OAAO,CAAC,GAAG,CAAC,oBAAoB,MAAM,IAAI,CAAC,EAAE,CAAC,UACtD,QAAQ,OAAO,CAAC,GAAG,CAAC,gBACpB;QAEF,gCAAgC;QAChC,MAAM,eAAe,gHAAM,CAAC,WAAW,CAAC,IAAI,QAAQ,CAAC;QAErD,0CAA0C;QAC1C,MAAM,mBAAmB,MAAM,yJAAiB,CAAC,IAAI,CAAC;YACpD,OAAO,MAAM,WAAW;YACxB,UAAU;QACZ;QAEA,QAAQ,GAAG,CAAC,CAAC,qBAAqB,EAAE,MAAM,QAAQ,EAAE,iBAAiB,MAAM,CAAC,kBAAkB,CAAC;QAE/F,kDAAkD;QAClD,IAAI,iBAAiB,MAAM,GAAG,GAAG;YAC/B,MAAM,yJAAiB,CAAC,UAAU,CAChC;gBAAE,OAAO,MAAM,WAAW;gBAAI,UAAU;YAAK,GAC7C;gBAAE,UAAU;YAAM;YAEpB,QAAQ,GAAG,CAAC,CAAC,YAAY,EAAE,iBAAiB,MAAM,CAAC,kBAAkB,CAAC;QACxE;QAEA,qBAAqB;QACrB,MAAM,aAAa,IAAI,yJAAiB,CAAC;YACvC;YACA,OAAO,MAAM,WAAW;YACxB;YACA;YACA,YAAY,cAAc;YAC1B,SAAS,WAAW;YACpB,IAAI,MAAM;YACV;YACA;YACA,UAAU;YACV,WAAW,IAAI;YACf,cAAc,IAAI;YAClB,WAAW,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,KAAK,KAAK;QACvD;QAEA,MAAM,WAAW,IAAI;QACrB,QAAQ,GAAG,CAAC,CAAC,qBAAqB,EAAE,WAAW,GAAG,EAAE;QAEpD,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT;YACA,WAAW,WAAW,GAAG;QAC3B,GACA;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA2B,GACpC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}